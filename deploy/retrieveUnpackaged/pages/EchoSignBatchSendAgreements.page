<apex:page controller="EchoSignBatchSendAgreementController" tabStyle="echosign_dev1__SIGN_Agreement__c" >
	<style>
	    .SFDSRightAligned {
	        text-align:right;
	    }
	</style>
 
     
    <script type="text/javascript">      
            function confirmInactivateLicenses() {
                return confirm('Would you like to proceed?');
            }       
    </script>       
    <apex:actionstatus id="status" startText="Requesting...">
          <apex:facet name="start">
              <c:INFW_ProgressInformation Message="Processing..." Width="104px" Height="470px"/>
          </apex:facet>
          <apex:facet name="stop">
         	
          </apex:facet>
   	</apex:actionstatus>
    <apex:form >
    	<apex:inputhidden id="sessionId" value="{!sessionID}"/>
    	<apex:inputhidden id="serverURL" value="{!serverURL}"/>
		<script>
			document.getElementById('{!$Component.sessionId}').value='{!$Api.Session_ID}';
			document.getElementById('{!$Component.serverURL}').value='{!$Api.Partner_Server_URL_70}';
		</script>
    	<apex:sectionHeader subtitle="{!$ObjectType.echosign_dev1__SIGN_Agreement__c.LabelPlural}" />
        <apex:pageBlock id="lOliGrid" title="Send Draft Agreements to EchoSign" mode="Edit">



<apex:outputPanel rendered="{!isStep1}">
 		      	<apex:pageBlockSection id="s3" collapsible="false" columns="1">				  
				<apex:outputPanel rendered="{!!isPreProcessing&&!isPostProcessing&&!isSuccess}">				 		      	
		                <apex:outputPanel >
		                <apex:pageBlockSection columns="1"  >
		                        <apex:pageBlockSectionItem >
									Click "Send" to submit all Draft Agreements to EchoSign.
		                        </apex:pageBlockSectionItem>                        
								<apex:pageBlockSectionItem >
		                            <apex:selectList value="{!whichMethod}" size="1" >
		                                <apex:selectOption itemValue="Send" itemLabel="Send Drafts" />
		                                <apex:selectOption itemValue="Nudge" itemLabel="Send Reminders" />
		                            </apex:selectList>    
                            	</apex:pageBlockSectionItem>
		                </apex:pageBlockSection>  
		                </apex:outputPanel> 
	      	
					    <apex:panelGrid columns="2">
					    	<apex:commandButton style="width:125px;" action="{!convertEchoSign}" status="status" rerender="lOliGrid" value="Send" rendered="{!!isSuccess&&!isFailed}" disabled="{!isProcessing}">				    	
					    	</apex:commandButton>	
					    	<apex:commandButton style="width:125px;" action="{!finish}" status="status" rerender="lOliGrid" value="Close" disabled="{!isProcessing}"/>
						</apex:panelGrid>
				</apex:outputPanel> 		
		     	</apex:pageBlockSection>   

				<apex:outputPanel rendered="{!isProcessing && !isPostProcessing}">
					<apex:actionPoller action="{!convertEchoSign}" rerender="lOliGrid" interval="5"/>
				</apex:outputPanel>
									
					<apex:repeat value="{!Jobs}" var="c">
						<div style="bgcolor:#CCCCCC">
							<table border="0" width="100%">
							<tr>
							<td><font face="Verdana, Arial, Helvetica, sans-serif" size="2"><b>{!c.jobName}:</b></font></td>
							</tr>
							<tr bgcolor="#999999">
							<td>
							<table border="0" width="{!IF((NOT ISNULL(c.job.TotalJobItems) && c.job.TotalJobItems>0),(c.job.JobItemsProcessed / c.job.TotalJobItems)*100,0)}%" cellspacing="1" bgcolor="{!IF(c.job.ExtendedStatus==null,'#0033FF','#FF0000')}">
							<tr>
							<td><font size="1">&nbsp;</font></td>
							</tr>
							</table>
							</td>
							</tr>
							<tr>
							<td>
							<table border="0" width="25%">
							<tr>
							<td><font face="Verdana, Arial, Helvetica, sans-serif" size="1">Status:</font></td>
							<td><font face="Verdana, Arial, Helvetica, sans-serif" size="1">{!IF(c.job.ExtendedStatus==null,c.job.Status,c.job.ExtendedStatus)}</font></td>
							</tr>
							</table>							
							</td>
							</tr>
							<tr></tr>
							</table>
						</div> 	
					</apex:repeat>  
					<apex:pageMessages id="messages"/>												
</apex:outputPanel>
        </apex:pageBlock>
    </apex:form>
</apex:page>